!function(i){i.fn.gallery=function(a){function t(i,a){s.imageArray.length=0,s.activeImage=0;for(var t=0;t<a.size();t++)s.imageArray.push([a.eq(t).attr("href"),a.eq(t).attr("title"),a.eq(t).find("."+s.captionClass).text(),a.eq(t).attr("data-date")]);for(;s.imageArray[s.activeImage][0]!==i.getAttribute("href");)s.activeImage++;v(),e()}function e(){i(".vix-loader").show(),i(".vix-image").hide();var a=new Image;a.onload=function(){i(".vix-image").attr("src",s.imageArray[s.activeImage][0]),n(),a.onload=function(){}},a.src=s.imageArray[s.activeImage][0]}function n(){o(),g(),i(".vix-loader").hide(),c()}function c(){i(".vix-image").fadeIn("fast"),r()}function o(){i(".vix-image-caption").text(s.imageArray[s.activeImage][2])}function r(){i(".vix-btn-prev").unbind().bind("click",function(){return 0===s.activeImage?s.activeImage=s.imageArray.length-1:s.activeImage=s.activeImage-1,e(),!1}),i(".vix-btn-next, .vix-image").unbind().bind("click",function(){return s.activeImage===s.imageArray.length-1?s.activeImage=0:s.activeImage=s.activeImage+1,e(),!1})}function v(){i("body").width(i(document).width()).css("overflow","hidden").append('<div class="vix-overlay"></div>');var a=i(".vix-overlay");s.background&&a.css("background-color",s.background),a.append('<div class="vix-modal"><div class="vix-title"></div><div class="vix-close"></div><button class="vix-btn vix-btn-prev"></button><button class="vix-btn vix-btn-next"></button><div class="vix-image-wrap"><div class="vix-loader"></div><img src="" alt="" class="vix-image" /></div></div>'),i(".vix-close").on("click",function(){d()}),a.fadeIn("fast")}function d(){i(".vix-overlay").fadeOut("fast",function(){i(this).remove(),i("body").css("overflow","auto").width("auto")})}function g(){i(".vix-title").text("Фотография "+(s.activeImage+1)+" из "+s.imageArray.length),i(".vix-image-date").text(s.imageArray[s.activeImage][3])}var s=i.extend({imgWidth:810,background:!1,captionClass:"vix-caption",imageArray:[],activeImage:0},a),m=i(this);return i(document).click(function(a){i(a.target).closest(".vix-modal").length||(d(),a.stopPropagation())}),i(document).ready(function(){i(this).keydown(function(i){27===i.which&&d()})}),i(this).unbind("click").click(function(){return t(this,m),!1})}}(jQuery);